<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title></title>

	<link rel="stylesheet" href="css/amazeui.min.css">
	<link rel="stylesheet" href="css/admin.css">
	<link rel="stylesheet" href="css/app.css">
	<link rel="stylesheet" href="css/amazeui.cropper.css">
	<link rel="stylesheet" href="css/custom_up_img.css">
	<style>
		.admin-main {
			padding-top: 0px;
		}
	</style>
	<style type="text/css">
		.up-img-cover {
			width: 210px;
			height: 279px;
		}

		.up-img-cover img {
			width: 100%;
		}
	</style>

</head>

<body>


	<div class="am-cf admin-main">
		<!-- content start -->
		<div class="admin-content">
			<div class="admin-content-body">
				<!--
				<div class="am-g">
					<form class="am-form am-form-horizontal" style="padding-top: 30px;">
						<input value="504" name="roleId" type="hidden">
						<div class="am-form-group">
							<label class="am-u-sm-3 am-form-label">
								<font color="#FF0000">BOOK</font>
							</label>
						</div>

						<div class="am-form">
							<label for="title" class="am-u-sm-3 am-form-label">
								BAR-CODE
							</label>
							<div class="am-u-sm-9">
								<input onblur="barcodeBlur()" id="barcode" required="" maxlength="13" oninput="value=value.replace(/[^\d]/g,'')"
								 placeholder="Example: 517593457154" value="" name="bar-code" type="text">
								<small id="helpRole">Please enter book bar-code.</small>
							</div>
						</div>

						<div class="am-form-group">
							<label for="title" class="am-u-sm-3 am-form-label">
								Title
							</label>
							<div class="am-u-sm-9">
								<input readonly="readonly" id="title" required="" value="" name="book-title" type="text">
							</div>
						</div>

						<div class="am-form-group">
							<label for="authors" class="am-u-sm-3 am-form-label">
								Authors
							</label>
							<div class="am-u-sm-9">
								<input readonly="readonly" id="authors" required="" value="" name="book-authors" type="text">
							</div>
						</div>


						<div class="am-form-group">
							<label for="isbn" class="am-u-sm-3 am-form-label">
								ISBN
							</label>
							<div class="am-u-sm-9">
								<input readonly="readonly" id="isbn" required="" value="" name="book-ISBN" type="text">
							</div>
						</div>

						<div class="am-form-group">
							<label for="press" class="am-u-sm-3 am-form-label">
								Press
							</label>
							<div class="am-u-sm-9">
								<input readonly="readonly" id="press" required="" value="" name="book-press" type="text">
							</div>
						</div>

						<div class="am-form-group">
							<label class="am-u-sm-3 am-form-label">
								<font color="#FF0000">BORROWER</font>
							</label>
						</div>

						<div class="am-form-group">
							<label for="phone" class="am-u-sm-3 am-form-label">
								Phone
							</label>
							<div class="am-u-sm-9">
								<input id="phone" onblur="borrowerBlur()" required="" maxlength="11" oninput="value=value.replace(/[^\d]/g,'')"
								 placeholder="Example: 18292020841" value="" name="borrower-phone" type="text">
								<small id="helpRole">Please enter phone number of the borrower.</small>
							</div>
						</div>

						<div class="am-form-group">
							<label for="name" class="am-u-sm-3 am-form-label">
								Name
							</label>
							<div class="am-u-sm-9">
								<input readonly="readonly" id="name" required="" value="" name="borrower-name" type="text">
							</div>
						</div>

				</div>
				-->
				<div class="am-u-lg-8 am-u-md-8 am-u-sm-centered">
					<br>
					<h1 style="color: #0e90d2">Book Information <small> / 图书信息</small></h1>
					<hr>
					<form class="am-form">
							<label for="barcode">
								BAR-CODE
							</label>
							<input onblur="barcodeBlur()" id="barcode" required="" maxlength="13" oninput="value=value.replace(/[^\d]/g,'')"
								placeholder="Example: 9780262035613" value="" name="bar-code" type="text">
					</form>
					
					<form class="am-form">
							<label for="title">
								Book Title
							</label>
							<input readonly="readonly" id="title" required="" value="" name="book-title" type="text">
					</form>

					<form class="am-form">
							<label for="authors">
								Authors
							</label>
							<input readonly="readonly" id="authors" required="" value="" name="book-authors" type="text">
					</form>

					<form class="am-form">
							<label for="isbn">
								ISBN
							</label>
							<input readonly="readonly" id="isbn" required="" value="" name="book-ISBN" type="text">
					</form>

					<form class="am-form">
							<label for="press">
								Publisher
							</label>
							<input readonly="readonly" id="press" required="" value="" name="book-press" type="text">
					</form>

					<h1 style="color: #0e90d2">Borrower Information <small> / 借阅人信息</small></h1>
					<hr>

					<form class="am-form">
							<label for="phone">
								Username
							</label>
							<input id="phone" onblur="borrowerBlur()" required="" maxlength="11" oninput="value=value.replace(/[^\d]/g,'')"
								 placeholder="Example: 18292020841" value="" name="borrower-phone" type="text">
					</form>

					<form class="am-form">
							<label for="name">
								Name
							</label>
							<input readonly="readonly" id="name" required="" value="" name="borrower-name" type="text">
					</form>
					<hr>
					<h1 style="color: #ff0000" id="fineValue" ></h1>
					<hr>
				</div>

				<script src="js/jquery-1.11.3.min.js"></script>
				<script src="js/amazeui.min.js" charset="utf-8"></script>
				<script src="js/cropper.min.js" charset="utf-8"></script>
				<script src="js/custom_up_img.js" charset="utf-8"></script>
				<br>
				<div class="am-form-group">
					<div class="am-u-sm-9 am-u-sm-push-3">
						<button onclick="lendBook()" class="am-btn am-btn-success">LEND</button>
						<button onclick="returnBook()" class="am-btn am-btn-success">RETURN</button>
					</div>
				</div>

				</form>
			</div>
		</div>
	</div>
	</div>
</body>

<script src="../cookie.js"></script>
<script src="../socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
	var socket = io("http://139.199.112.88:2761");

	socket.on("bookInformation", function (data) {
		data = data.book_info;
		$("#title").attr("value", data.book_name);
		$("#authors").attr("value", data.author);
		$("#isbn").attr("value", data.isbn);
		$("#press").attr("value", data.press);
	});

	socket.on("borrowerInformation", function (data) {
		$("#name").attr("value", data.name);
	});

	socket.on("readerInfoForReturn", function(data){
		$("#phone").attr("value", data.reader_id);
		document.getElementById("fineValue").innerHTML = "Fine Value of This Book: " + data.fine.toString() + " yuan";
		$("#name").attr("value", data.name);
	});

	socket.on("copyNotExist", function () {
		alert("Specified copy is not exist.");
		location.href = location.href;
	});

	socket.on("notAvailable", function () {
		alert("Specified copy is not available.");
		location.href = location.href;
	});

	socket.on("readerNotExist", function () {
		alert("Specified reader is not exist.");
		location.href = location.href;
	});

	socket.on("limitExceed", function () {
		alert("Specified reader has borrowed 3 books.");
		location.href = location.href;
	});

	socket.on("borrowSuccess", function () {
		alert("Successfully Borrowed.");
		location.href = location.href;
	});

	socket.on("returnBookSuccess", function () {
		alert("Specified book has been successfully returned");
		location.href = location.href;
	});

	socket.on("allBorrows", function () {
		alert("Specified book has been all borrowed");
		location.href = location.href;
	});

	socket.on("noRecord", function () {
		alert("No borrow record.");
		location.href = location.href;
	});

	function barcodeBlur() {
		var data = {};
		data.bar_code = parseInt($("#barcode").val());
		socket.emit("getBookInformation", data);
	}

	function borrowerBlur() {
		var data = {};
		data.phone = $("#phone").val();
		socket.emit("getBorrowerInformation", data);
	}


	function lendBook() {
		var data = {};
		data.lend_librarian_id = Cookies.get("username");
		data.bar_code = parseInt($("#barcode").val());
		data.phone = $("#phone").val();
		socket.emit("borrowBook", data);
	}

	function returnBook() {
		var data = {};
		data.return_librarian_id = Cookies.get("username");
		data.bar_code = parseInt($("#barcode").val());
		data.phone = $("#phone").val();
		socket.emit("returnBook", data);
	}




</script>

</html>